#!/usr/bin/env python3
import re, os, time, json, datetime
import tldextract
from colorama import Fore, Style, init

init(autoreset=True)

# ---------------- UTILS ----------------
def slow(text, color=Fore.WHITE, d=0.01):
    for c in text:
        print(color + c, end='', flush=True)
        time.sleep(d)
    print()

def beep():
    print('\a', end='')  # terminal beep

def load_rules():
    with open("rules.db") as f:
        return [x.strip().lower() for x in f.readlines() if x.strip()]

def get_domain(url):
    e = tldextract.extract(url)
    return f"{e.domain}.{e.suffix}"

# ---------------- BANNER ----------------
def banner():
    print(Fore.RED + Style.BRIGHT + r"""
██████╗ ██╗      █████╗  ██████╗██╗  ██╗
██╔══██╗██║     ██╔══██╗██╔════╝██║ ██╔╝
██████╔╝██║     ███████║██║     █████╔╝ 
██╔══██╗██║     ██╔══██║██║     ██╔═██╗ 
██████╔╝███████╗██║  ██║╚██████╗██║  ██╗
╚═════╝ ╚══════╝╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝
""")
    slow(" > TEAM BLACK HAT :: PHISHING ENGINE", Fore.RED)
    slow(" > Bulk • Offline • Report Mode\n", Fore.RED)

# ---------------- ANALYSIS ----------------
def analyze(url, rules):
    score = 0
    hits = []

    if not url.startswith("https"):
        score += 2
        hits.append("NO HTTPS")

    if re.search(r'\b\d{1,3}(\.\d{1,3}){3}\b', url):
        score += 3
        hits.append("RAW IP USED")

    for r in rules:
        if r in url.lower():
            score += 1
            hits.append(f"RULE MATCH: {r}")

    if len(url) > 75:
        score += 1
        hits.append("LONG URL")

    status = (
        "CLEAN" if score <= 2 else
        "SUSPICIOUS" if score <= 5 else
        "HIGH RISK"
    )

    return {
        "url": url,
        "domain": get_domain(url),
        "score": score,
        "status": status,
        "findings": hits
    }

# ---------------- REPORT ----------------
def save_report(results):
    os.makedirs("reports", exist_ok=True)
    ts = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")

    txt = f"reports/blackhat_{ts}.txt"
    js  = f"reports/blackhat_{ts}.json"

    with open(txt, "w") as f:
        for r in results:
            f.write(f"\nURL: {r['url']}\n")
            f.write(f"Domain: {r['domain']}\n")
            f.write(f"Score: {r['score']}\n")
            f.write(f"Status: {r['status']}\n")
            for h in r['findings']:
                f.write(f" - {h}\n")

    with open(js, "w") as f:
        json.dump(results, f, indent=4)

    print(Fore.GREEN + f"\n[+] TXT  -> {txt}")
    print(Fore.GREEN + f"[+] JSON -> {js}")

# ---------------- MAIN ----------------
def main():
    banner()
    rules = load_rules()
    results = []

    if os.path.exists("urls.txt"):
        slow("[*] Bulk mode detected", Fore.CYAN)
        with open("urls.txt") as f:
            urls = [x.strip() for x in f if x.strip()]
    else:
        urls = [input(Fore.RED + "blackhat@scan ~$ ").strip()]

    for u in urls:
        r = analyze(u, rules)
        results.append(r)

        print(Fore.WHITE + "\n[TARGET] " + Fore.CYAN + u)
        print(Fore.MAGENTA + f"[SCORE] {r['score']}  [STATUS] {r['status']}")
        if r["status"] == "HIGH RISK":
            beep()

    save_report(results)

if __name__ == "__main__":
    main()
